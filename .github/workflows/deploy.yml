name: Build and Deploy Documentation

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: ğŸ“¦ Check and install LibreOffice
        id: libreoffice
        run: |
          # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ»Ğ¸ LibreOffice
          if command -v libreoffice &> /dev/null; then
            echo "âœ… LibreOffice already installed"
            libreoffice --version | head -1
            echo "cached=true" >> $GITHUB_OUTPUT
          else
            echo "ğŸ”„ Installing LibreOffice..."
            sudo apt-get update
            sudo apt-get install -y libreoffice
            echo "cached=false" >> $GITHUB_OUTPUT
          fi

      - name: ğŸ“‹ Install Python dependencies
        run: |
          pip install --upgrade pip
          pip install PyYAML Jinja2 markupsafe python-docx odfpy click colorama

      - name: ğŸ—ï¸ Generate documents
        run: |
          echo "ğŸ—ï¸ Generating documents..."
          python docs/scripts/builders/build_docs.py all

      - name: ğŸŒ Generate website
        run: |
          echo "ğŸŒ Generating website..."
          python docs/scripts/builders/build_site.py

      - name: ğŸ“¤ Deploy to gh-pages branch
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs/output/web
          publish_branch: gh-pages